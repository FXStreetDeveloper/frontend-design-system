(function(){FXStreetWidgets.Widget.Base=function(n){var t={};return t.Container=FXStreetWidgets.Widget.Base.prototype.Container,t.loaderBase=n,t.data=FXStreetWidgets.Widget.Base.prototype.data,t.interval=FXStreetWidgets.Widget.Base.prototype.interval,t.init=FXStreetWidgets.Widget.Base.prototype.init,t.setSettingsByObject=FXStreetWidgets.Widget.Base.prototype.setSettingsByObject,t.addEvents=FXStreetWidgets.Widget.Base.prototype.addEvents,t.setVars=FXStreetWidgets.Widget.Base.prototype.setVars,t.loadData=FXStreetWidgets.Widget.Base.prototype.loadData,t.loadDataFromUrl=FXStreetWidgets.Widget.Base.prototype.loadDataFromUrl,t.setDatesToJson=FXStreetWidgets.Widget.Base.prototype.setDatesToJson,t.renderHtml=FXStreetWidgets.Widget.Base.prototype.renderHtml,t.log=FXStreetWidgets.Widget.Base.prototype.log,t.jsonDataIsValid=FXStreetWidgets.Widget.Base.prototype.jsonDataIsValid,t.handleJsonInvalidData=FXStreetWidgets.Widget.Base.prototype.handleJsonInvalidData,t};FXStreetWidgets.Widget.Base.prototype.Container=null;FXStreetWidgets.Widget.Base.prototype.loaderBase=null;FXStreetWidgets.Widget.Base.prototype.data=null;FXStreetWidgets.Widget.Base.prototype.interval=null;FXStreetWidgets.Widget.Base.prototype.init=function(n){this.setSettingsByObject(n)};FXStreetWidgets.Widget.Base.prototype.setSettingsByObject=function(n){for(var t in n)n.hasOwnProperty(t)&&this[t]!==undefined&&(this[t]=n[t])};FXStreetWidgets.Widget.Base.prototype.addEvents=function(){};FXStreetWidgets.Widget.Base.prototype.setVars=function(){};FXStreetWidgets.Widget.Base.prototype.loadData=function(n){this.loadDataFromUrl(this.loaderBase.config.EndPoint,n)};FXStreetWidgets.Widget.Base.prototype.loadDataFromUrl=function(n,t){var i=this;FXStreetWidgets.Util.ajaxJsonGetter(n,t).done(function(n){if(!i.jsonDataIsValid(n)){i.handleJsonInvalidData();return}i.data=n;i.loaderBase.isReady()?(i.log("start renderHtml for: "+i.loaderBase.config.WidgetName),i.renderHtml()):i.interval=setInterval(function(){i.loaderBase.isReady()&&(clearInterval(i.interval),i.log("start renderHtml for: "+i.loaderBase.config.WidgetName),i.renderHtml())},i.intervalTimeToWaitForReady)})};FXStreetWidgets.Widget.Base.prototype.setDatesToJson=function(n,t){var i=FXStreetWidgets.Util.formatDate(t);return n.LastUpdatedDate=t,n.LastUpdatedHour=i,n};FXStreetWidgets.Widget.Base.prototype.renderHtml=function(){};FXStreetWidgets.Widget.Base.prototype.log=function(n){FXStreetWidgets.Util.log(n)};FXStreetWidgets.Widget.Base.prototype.jsonDataIsValid=function(n){return FXStreetWidgets.Util.isValid(n)&&FXStreetWidgets.Util.arrayIsValid(n.Values)&&FXStreetWidgets.Util.isValid(n.Values[0])};FXStreetWidgets.Widget.Base.prototype.handleJsonInvalidData=function(){var t=this,n=t.loaderBase.config.Translations.NoDataAvailable;FXStreetWidgets.Util.isValid(n)||(n="No data available");t.Container.html(n)}})(),function(n){FXStreetWidgets.Widget.LoaderBase=function(t){var i={};return i.options=t,i.config=FXStreetWidgets.Widget.LoaderBase.prototype.config,i.isReady=FXStreetWidgets.Widget.LoaderBase.prototype.isReady,i.isReadyCustomCheck=FXStreetWidgets.Widget.LoaderBase.prototype.isReadyCustomCheck,i.initConfiguration=FXStreetWidgets.Widget.LoaderBase.prototype.initConfiguration,i.getContainer=FXStreetWidgets.Widget.LoaderBase.prototype.getContainer,i.getHost=FXStreetWidgets.Widget.LoaderBase.prototype.getHost,i.getVersion=FXStreetWidgets.Widget.LoaderBase.prototype.getVersion,i.getCustomJs=FXStreetWidgets.Widget.LoaderBase.prototype.getCustomJs,i.getSharedJs=FXStreetWidgets.Widget.LoaderBase.prototype.getSharedJs,i.getEndPoint=FXStreetWidgets.Widget.LoaderBase.prototype.getEndPoint,i.getEndPointTranslation=FXStreetWidgets.Widget.LoaderBase.prototype.getEndPointTranslation,i.initWidgets=FXStreetWidgets.Widget.LoaderBase.prototype.initWidgets,i.log=FXStreetWidgets.Widget.LoaderBase.prototype.log,i.chartLibrariesAreLoaded=FXStreetWidgets.Widget.LoaderBase.prototype.chartLibrariesAreLoaded,i.getDefaultHost=FXStreetWidgets.Widget.LoaderBase.prototype.getDefaultHost,i.mustachesCount=0,i.mustachesLoadedCount=0,i.customJsCount=0,i.customJsLoadedCount=0,i.sharedJsCount=0,i.sharedJsLoadedCount=0,i.translationsLoaded=!1,i.haveCustomJs=!1,i.haveSharedJs=!1,i.init=function(){if(!FXStreetWidgets.Util.isValid(i.options)||!FXStreetWidgets.Util.isValid(i.options.WidgetName)||!i.options.WidgetName.trim()){i.log("unable to load fxswidget options bad configure.");return}FXStreetWidgets.Initialization.registerLoader(i.options.WidgetName,i);i.initConfiguration();i.loadUtils();var t=n("div[fxs_widget][fxs_name='"+i.options.WidgetName+"']");FXStreetWidgets.Util.async(function(){i.initWidgets(t)})},i.loadDeferred=function(n){i.log("loading deferred "+i.options.WidgetName);var t=n.find("div[fxs_widget][fxs_name='"+i.options.WidgetName+"']");i.initWidgets(t)},i.loadUtils=function(){FXStreetWidgets.Util.ajaxJsonGetter(i.config.EndPointTranslation).done(function(n){i.translationsLoaded=!0;i.config.Translations=n.Values});n.each(i.config.CustomJs,function(n,t){i.customJsCount++;var u="",r="",f;typeof t=="string"?(r=t,u=FXStreetWidgets.Configuration.getCoreJsUrl(r)):t&&typeof t=="object"&&(r=t.Js,u=FXStreetWidgets.Configuration.getCoreJsUrl(r),f=t.CustomLoadedDelegate);FXStreetWidgets.ResourceManagerObj.load(r,FXStreetWidgets.ResourceType.Js,u,function(){i.customJsLoadedCount++},f)});n.each(i.config.SharedJs,function(n,t){i.sharedJsCount++;var r=FXStreetWidgets.Configuration.createResourceUrl(t.Container,t.Js);FXStreetWidgets.ResourceManagerObj.load(t.Js,FXStreetWidgets.ResourceType.Js,r,function(){i.sharedJsLoadedCount++},t.CustomLoadedDelegate)});n.each(i.config.Mustaches,function(n){i.mustachesCount++;var t=n+".html",r=FXStreetWidgets.Configuration.getMustacheUrl(t,i.options.WidgetName);FXStreetWidgets.ResourceManagerObj.load(t,FXStreetWidgets.ResourceType.Mustache,r,function(t){i.config.Mustaches[n]=t.Value;i.mustachesLoadedCount++})})},i.async_loadjs=function(n,t){var r=document.getElementsByTagName("script")[0],i=document.createElement("script");i.type="text/javascript";i.async=!0;i.src=n;t&&typeof t=="function"&&(i.addEventListener?i.addEventListener("load",t,!1):i.onreadystatechange=function(){(this.readyState==="complete"||this.readyState==="loaded")&&t.call()});r.parentNode.insertBefore(i,r)},i};FXStreetWidgets.Widget.LoaderBase.prototype.config={};FXStreetWidgets.Widget.LoaderBase.prototype.initWidgets=function(){};FXStreetWidgets.Widget.LoaderBase.prototype.initConfiguration=function(){this.log("init configuration for: "+this.options.WidgetName);var n=this.getContainer(),t=this.getHost(n),i=this.getVersion(n),r=this.getCustomJs(),u=this.getSharedJs();this.config={WidgetType:this.options.WidgetType,WidgetName:this.options.WidgetName,Culture:FXStreetWidgets.Configuration.getCulture(),EndPoint:this.getEndPoint(t,i),EndPointTranslation:this.getEndPointTranslation(t,i),DefaultHost:this.getDefaultHost(this.options),CustomJs:r,SharedJs:u,Mustaches:this.options.Mustaches,Translations:{}}};FXStreetWidgets.Widget.LoaderBase.prototype.getDefaultHost=function(n){var t=FXStreetWidgets.Configuration.getHosts(),i,r;return t?(i=t[n.WidgetType],r=i||n.DefaultHost,r):n.DefaultHost};FXStreetWidgets.Widget.LoaderBase.prototype.getContainer=function(){return n("div[fxs_widget][fxs_name='"+this.options.WidgetName+"']").first()};FXStreetWidgets.Widget.LoaderBase.prototype.getHost=function(n){n=n||this.getContainer();var t=n.attr("fxs_host");return FXStreetWidgets.Util.isUndefined(t)?this.getDefaultHost(this.options):t};FXStreetWidgets.Widget.LoaderBase.prototype.getVersion=function(n){n=n||this.getContainer();var t=n.attr("fxs_version")||this.options.DefaultVersion;return FXStreetWidgets.Util.isUndefined(t)?"":t};FXStreetWidgets.Widget.LoaderBase.prototype.getCustomJs=function(){var n=[];return FXStreetWidgets.Util.arrayIsValid(this.options.CustomJs)&&(this.haveCustomJs=!0,n=this.options.CustomJs),n};FXStreetWidgets.Widget.LoaderBase.prototype.getSharedJs=function(){var n=[];return FXStreetWidgets.Util.arrayIsValid(this.options.SharedJs)&&(this.haveSharedJs=!0,n=this.options.SharedJs),n};var t=function(n,t){return n.replace(/{version}/g,t).replace(/{culture}/g,FXStreetWidgets.Configuration.getCulture())};FXStreetWidgets.Widget.LoaderBase.prototype.getEndPoint=function(n,i){var r,u;return this.options.EndPointV2?(u=t(this.options.EndPointV2,i),r=n+u):r=n+(i?i+"/":"")+FXStreetWidgets.Configuration.getCulture()+"/"+this.options.EndPoint,r};FXStreetWidgets.Widget.LoaderBase.prototype.getEndPointTranslation=function(n,i){var r,u;return this.options.EndPointTranslationV2?(u=t(this.options.EndPointTranslationV2,i),r=n+u):r=n+(i?i+"/":"")+FXStreetWidgets.Configuration.getCulture()+"/"+this.options.EndPointTranslation,r};FXStreetWidgets.Widget.LoaderBase.prototype.isReady=function(){var n=this.translationsLoaded===!0&&(this.haveCustomJs===!1||this.haveCustomJs===!0&&this.customJsLoadedCount>=this.customJsCount)&&(this.haveSharedJs===!1||this.haveSharedJs===!0&&this.sharedJsLoadedCount>=this.sharedJsCount)&&this.mustachesLoadedCount===this.mustachesCount;return n=n&&this.isReadyCustomCheck(),n===!0&&this.log("loader ready for: "+this.options.WidgetName),n};FXStreetWidgets.Widget.LoaderBase.prototype.isReadyCustomCheck=function(){return!0};FXStreetWidgets.Widget.LoaderBase.prototype.chartLibrariesAreLoaded=function(){return typeof d3!="undefined"&&typeof c3!="undefined"};FXStreetWidgets.Widget.LoaderBase.prototype.log=function(n){FXStreetWidgets.Util.log(n)}}(FXStreetWidgets.$),function(n){FXStreetWidgets.Widget.KtlTable={};FXStreetWidgets.Widget.KtlTable.SelectedFilter={Fibonacci:"Fibonacci",PivotPoints:"PivotPoints",Sma:"Sma",HighLows:"CandleSticks",BollingerBands:"BollingerBands"};FXStreetWidgets.Widget.KtlTable.Manager=function(t){var a=FXStreetWidgets.Widget.Base(t),i=FXStreetWidgets.Util.extendObject(a);i.ContainerId="";i.WidgetId="";var r={},h="",f=[],u=null,c=[],e="",o=[];i.init=function(n){i.setSettingsByObject(n);l(n)};i.setVars=function(){r=i.loaderBase.config.Translations;h=i.loaderBase.config.EndPoint;f=JSON.parse(r.KtlTableFilters).Values;o=f[0].AssetIds;v();y();p()};i.renderHtml=function(){w();b();s()};var v=function(){var n={WidgetId:i.WidgetId},t=FXStreetWidgets.Util.renderByHtmlTemplate(i.loaderBase.config.Mustaches[i.loaderBase.config.WidgetName],n);i.Container.html(t)},y=function(){u=new FXStreetWidgets.Widget.KtlTable.FilterManager(t);var n={ContainerId:"ktltablefilters_"+i.WidgetId,WidgetId:i.WidgetId,DefaultFilter:FXStreetWidgets.Widget.KtlTable.SelectedFilter.Fibonacci,Translations:r,onDataTypeFilterClickDelegate:nt,onAssetFilterClickDelegate:tt};u.init(n);u.render();e=u.getActiveFilter()},p=function(){var n=new FXStreetWidgets.Widget.KtlTable.ContentMock(t),u={WidgetId:i.WidgetId,ContainerId:"ktltablecontent_"+i.WidgetId,Translations:r};n.init(u)},w=function(){var n=i.data.Values[0].TechnicalData.Fibonacci[0].Date;u.setLastUpdated(n)},b=function(){n.each(FXStreetWidgets.Widget.KtlTable.SelectedFilter,function(n,t){k(t)})},k=function(n){var u=new FXStreetWidgets.Widget.KtlTable.Content(t),f={ContainerId:"ktltablecontent_"+i.WidgetId,WidgetId:i.WidgetId,FilterApplied:n,AssetsData:i.data.Values,Translations:r};u.init(f);c.push(u)},s=function(){n.each(c,function(n,t){if(t.FilterApplied===e)return t.render(o),!1})},l=function(n,t){t=typeof t!="undefined"&&t!==null?t:0;t>=10?console.error("FXStreetWidgets: Operation took too long"):i.loaderBase.isReady()?(i.setVars(n),d()):setTimeout(function(){l(n,t+1)},500)},d=function(){var n=g();i.loadDataFromUrl(n)},g=function(){var t=[],i,r;return n.each(f,function(i,r){n.each(r.AssetIds,function(n,i){t.indexOf(i)===-1&&t.push(i)})}),i="?assetIds="+t.join(),r=h+i,r},nt=function(n){e=n;s()},tt=function(n){o=f[n].AssetIds;s()};return i};FXStreetWidgets.Widget.KtlTable.ContentMock=function(t){var u=FXStreetWidgets.Widget.Base(t),i=FXStreetWidgets.Util.extendObject(u),r;return i.WidgetId="",i.ContainerId="",i.Translations={},i.init=function(n){i.setSettingsByObject(n);i.setVars(n);r()},i.setVars=function(){i.Container=n("#"+i.ContainerId)},r=function(){var n={WidgetId:i.WidgetId,Translations:i.Translations},t=FXStreetWidgets.Util.renderByHtmlTemplate(i.loaderBase.config.Mustaches.ktltablecontent_mock,n);i.Container.html(t)},i};FXStreetWidgets.Widget.KtlTable.Content=function(t){var f=FXStreetWidgets.Widget.Base(t),i=FXStreetWidgets.Util.extendObject(f),r;i.ContainerId="";i.WidgetId="";i.AssetsData=[];i.FilterApplied="";i.Translations=null;r={};i.init=function(n){i.setSettingsByObject(n);i.setVars(n)};i.setVars=function(t){i.AssetsData=n.map(t.AssetsData,function(n){return{Asset:n.Asset,Data:n.TechnicalData[i.FilterApplied]}});i.Container=n("#"+i.ContainerId);s()};i.render=function(n){var t={WidgetId:r.WidgetId,Pairs:r.Pairs.filter(function(t){return u(t.AssetId,n)}),Technicals:r.Technicals.map(function(t){return e(t,n)}),Translations:i.Translations},f=FXStreetWidgets.Util.renderByHtmlTemplate(i.loaderBase.config.Mustaches.ktltablecontent,t);i.Container.html(f)};var u=function(n,t){return t.indexOf(n)>-1?!0:!1},e=function(n,t){return{TechnicalName:n.TechnicalName,Values:n.Values.filter(function(n){return u(n.AssetId,t)})}},o=function(t,i){var r=null;return n.each(t.Data,function(n,t){if(t.PeriodType===i)return r=t,!1}),r},s=function(){var e=i.AssetsData.map(function(n){return{AssetId:n.Asset.Id,Name:n.Asset.Name,Url:n.Asset.Url}}),f=[],t=JSON.parse(i.Translations.KtlDataTypeFilters)[i.FilterApplied];for(var u in t)t.hasOwnProperty(u)&&n.each(t[u],function(t,r){var e={TechnicalName:r.Translation,Values:[]};n.each(i.AssetsData,function(n,t){var f=o(t,u),i,s;f!==null&&(i=f[r.PropertyName],s={Data:i!==null?i.toFixed(t.Asset.DecimalPlaces):null,AssetId:t.Asset.Id},e.Values.push(s))});f.push(e)});r={WidgetId:i.WidgetId,Pairs:e,Technicals:f}};return i};FXStreetWidgets.Widget.KtlTable.FilterManager=function(t){var l=FXStreetWidgets.Widget.Base(t),i=FXStreetWidgets.Util.extendObject(l);i.ContainerId="";i.WidgetId="";i.DefaultFilter="";i.Translations={};i.onDataTypeFilterClickDelegate=function(){console.error("Fxswidgets error: Filter delegate is not defined")};i.onAssetFilterClickDelegate=function(){console.error("Fxswidgets error: Filter delegate is not defined")};var r="",u={},f=[],o=null,s=null,h=null,c=null;i.init=function(n){i.setSettingsByObject(n);i.setVars(n)};i.setVars=function(n){r=n.DefaultFilter;f=JSON.parse(i.Translations.KtlTableFilters).Values};i.render=function(){var u=[],t,e,o;n.each(FXStreetWidgets.Widget.KtlTable.SelectedFilter,function(n,t){var f={Id:t,Name:i.Translations[t],IsActive:t===r};u.push(f)});t=[];n.each(f,function(n,i){var r={Id:n,Title:i.Title};t.push(r)});e={WidgetId:i.WidgetId,Filters:u,AssetsFilter:t,Translations:{LastUpdated:i.Translations.LastUpdated.replace("{0}",new Date),AssetList:i.Translations.AssetList}};i.Container=n("#"+i.ContainerId);o=FXStreetWidgets.Util.renderByHtmlTemplate(i.loaderBase.config.Mustaches.ktltablefilters,e);i.Container.html(o);c=n("#fxs_ktltable_lastupdated_"+i.WidgetId);a()};i.getActiveFilter=function(){return r};i.setLastUpdated=function(n){var t=i.Translations.LastUpdated.replace("{0}",n);c.html(t)};var a=function(){v();p()},v=function(){n.each(FXStreetWidgets.Widget.KtlTable.SelectedFilter,function(t,r){var e="fxs_ktltable_filter_"+r+"_"+i.WidgetId,f=n("#"+e);u[r]=f;f.on("click",function(){y(r)})})},y=function(t){n.each(FXStreetWidgets.Widget.KtlTable.SelectedFilter,function(n,i){u[i].removeClass("active");i===t&&u[i].addClass("active")});i.onDataTypeFilterClickDelegate(t)},p=function(){s=n("#fxs_ktltable_assetFilterBox_"+i.WidgetId);h=n("#fxs_ktltable_assetFilterCloseButton_"+i.WidgetId);h.on("click",e);o=n("#fxs_ktltable_assetfilterbutton_"+i.WidgetId);o.on("click",e);n.each(f,function(t){var r=n("#fxs_ktltable_assetfilter_"+t+"_"+i.WidgetId);r.on("click",function(){i.onAssetFilterClickDelegate(t);e()})})},e=function(){s.toggleClass("fxs_hideElements")};return i}}(FXStreetWidgets.$),function(n){FXStreetWidgets.Widget.LoaderKtlTable=function(){var i=FXStreetWidgets.Widget.LoaderBase({WidgetType:"MarketTools",WidgetName:"ktltable",EndPointV2:"api/v2.1/keytechnicals",EndPointTranslationV2:"api/v2/cultures/{culture}/ktltable/",DefaultHost:"http://markettools.fxstreet.com/",Mustaches:{ktltable:"",ktltablecontent:"",ktltablecontent_mock:"",ktltablefilters:""},DefaultVersion:"v2.1"}),t=FXStreetWidgets.Util.extendObject(i);return i.initWidgets=function(i){n.each(i,function(i,r){var e=n(r),u={WidgetId:FXStreetWidgets.Util.guid(),Container:e},f;t.checkConfiguration(u)&&(f=new FXStreetWidgets.Widget.KtlTable.Manager(t),f.init(u))})},t.jsonDataIsValid=function(){return!0},t.checkConfiguration=function(){return!0},t},function(){var n=new FXStreetWidgets.Widget.LoaderKtlTable;n.init()}()}(FXStreetWidgets.$);
//# sourceMappingURL=ktltable.min.js.map